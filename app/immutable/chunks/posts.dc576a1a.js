import{f as _,r as w,R as g,A as m}from"./user-id-store.66fd1ad4.js";import{g as h}from"./tag-type-data.934b5280.js";const u=new Map,d=20;let f=null;const F=async(t,e,n="",s="")=>{const o=k(t,e,n,s),i=await _(o,f);l(i);try{let r=await i.json();r=r.filter(c=>c.change);const a=r.map($);return a.forEach(c=>{u.set(c.id,c)}),a}catch(r){return console.warn("Failed to get posts",r),[]}},L=async(t,e="",n="")=>{const s=await _(R(t,e,n),f);l(s);const o=await s.text(),r=new DOMParser().parseFromString(o,"text/xml"),a=Number(r.getElementsByTagName("posts")[0].getAttribute("count"));return q(a),a},M=async(t,e="",n="")=>{if(!u.has(t)){let o="";n&&e?o=`${g}&s=post&q=index&fields=tag_info&json=1&id=${t}&api_key=${e}&user_id=${n}`:o=`${m}/post?id=${t}`;const i=await fetch(o);l(i);const r=await i.json(),a=$(r[0]);u.set(a.id,a)}const s=u.get(t);if(s===void 0)throw new Error("Post cannot be undefined");return s},l=t=>{if(!t.ok)throw new Error(`getPage failed with http status ${t.status}`)},$=t=>{const e=t.height,n=t.score,s=t.preview_url,o=t.file_url,i=t.parent_id,r=t.sample_url,a=t.sample_width,c=t.sample_height,b=t.rating,p=t.tag_info,P=t.tags,y=t.id,x=t.width,N=t.change,v=t.comment_count,E=t.status,A=t.source;return{preview_url:s,sample_url:r,file_url:o,comment_count:Number(v),height:Number(e),id:Number(y),change:Number(N)*1e3,parent_id:i?Number(i):void 0,rating:b,sample_height:Number(c),sample_width:Number(a),score:Number(n),source:A,status:E,tags:p?T(p):U(P),width:Number(x),type:I(o)}},T=t=>t.map(C).sort(j),U=t=>t.split(" ").map(S),C=({tag:t,count:e,type:n})=>({name:w(t),count:e,type:n}),S=t=>({name:w(t),count:0,type:"ambiguous"}),j=(t,e)=>h(t.type)-h(e.type),k=(t,e,n,s)=>{let o="";return s&&n?o=`${g}&s=post&q=index&fields=tag_info&json=1&api_key=${n}&user_id=${s}&limit=${d}&pid=${t}`:o=`${m}/posts?limit=${d}&pid=${t}`,e===""?o:`${o}&tags=${e}`},R=(t,e,n)=>{let s="";return n&&e?s=`${g}&s=post&q=index&limit=0&api_key=${e}&user_id=${n}`:s=`${m}/count`,t===""?s:`${s}?tags=${t}`},q=t=>{if(typeof t!="number")throw new Error("Unexpected response received in getPage")},I=t=>t.endsWith(".webm")||t.endsWith(".mp4")?"video":t.includes(".gif")?"gif":"image";export{F as a,L as b,k as c,M as g};
