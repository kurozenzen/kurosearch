import{f as p,r as h,A as i}from"./tags.1f9b768a.js";import{g as m}from"./tag-type-data.934b5280.js";const c=new Map,E=20;let l=null;const M=async(t,e)=>{const n=I(t,e),o=await p(n,l);u(o);try{let s=await o.json();s=s.filter(a=>a.change);const r=s.map(d);return r.forEach(a=>{c.set(a.id,a)}),r}catch(s){return console.warn("Failed to get posts",s),[]}},R=async t=>{const e=await p(O(t),l);u(e);const n=await e.text(),s=new DOMParser().parseFromString(n,"text/xml"),r=Number(s.getElementsByTagName("posts")[0].getAttribute("count"));return j(r),r},W=async t=>{if(!c.has(t)){const n=new URL(`${i}/post`);n.searchParams.append("id",String(t));const o=await fetch(n);u(o);const s=await o.json(),r=d(s[0]);c.set(r.id,r)}const e=c.get(t);if(e===void 0)throw new Error("Post cannot be undefined");return e},u=t=>{if(!t.ok)throw new Error(`getPage failed with http status ${t.status}`)},d=t=>{const e=t.height,n=t.score,o=t.preview_url,s=t.file_url,r=t.parent_id,a=t.sample_url,w=t.sample_width,b=t.sample_height,f=t.rating,g=t.tag_info,_=t.tags,P=t.id,y=t.width,N=t.change,$=t.comment_count,v=t.status,x=t.source;return{preview_url:o,sample_url:a,file_url:s,comment_count:Number($),height:Number(e),id:Number(P),change:Number(N)*1e3,parent_id:r?Number(r):void 0,rating:f,sample_height:Number(b),sample_width:Number(w),score:Number(n),source:x,status:v,tags:g?A(g):S(_),width:Number(y),type:D(s)}},A=t=>t.map(T).sort(C),S=t=>t.split(" ").map(U),T=({tag:t,count:e,type:n})=>({name:h(t),count:e,type:n}),U=t=>({name:h(t),count:0,type:"ambiguous"}),C=(t,e)=>m(t.type)-m(e.type),I=(t,e)=>{const n=`${i}/posts?limit=${E}&pid=${t}`;return e===""?n:`${n}&tags=${e}`},O=t=>{const e=`${i}/count`;return t===""?e:`${e}?tags=${t}`},j=t=>{if(typeof t!="number")throw new Error("Unexpected response received in getPage")},D=t=>t.endsWith(".webm")||t.endsWith(".mp4")?"video":t.includes(".gif")?"gif":"image";export{M as a,R as b,I as c,W as g};
